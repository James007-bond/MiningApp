<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>MiningApp</title>
<style>
  :root{font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  body{margin:0;background:#0b1020;color:#e6eef8;display:flex;align-items:center;justify-content:center;height:100vh}
  .card{width:96%;max-width:820px;background:linear-gradient(180deg,#0f1724 0%, #091023 100%);border-radius:12px;padding:20px;box-shadow:0 8px 30px rgba(2,8,23,.6);}
  h1{margin:0 0 8px;font-size:20px}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .panel{flex:1;min-width:220px;background:rgba(255,255,255,0.02);padding:14px;border-radius:8px}
  button{background:#14b8a6;border:none;padding:10px 14px;border-radius:8px;color:#021018;font-weight:700;cursor:pointer}
  button.stop{background:#ef4444;color:white}
  .meter{height:12px;background:rgba(255,255,255,0.06);border-radius:8px;overflow:hidden;margin-top:8px}
  .meter > i{display:block;height:100%;width:4%;background:linear-gradient(90deg,#22c1c3,#1c7ed6);transition:width .2s linear}
  .stat{font-size:13px;margin-top:6px;color:#cfeffd}
  small{color:#88b1c8}
  .footer{margin-top:12px;font-size:12px;color:#8aa7bd}
</style>
</head>
<body>
  <div class="card">
    <h1>⛏️ MiningApp Panel</h1>
    <div class="row">
      <div class="panel">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="stat">Durum: <strong id="status">Hazır</strong></div>
            <small>Gerçek mining değilse sahte/örnek veri üretir.</small>
          </div>
          <div>
            <button id="startBtn">Başlat</button>
            <button id="stopBtn" class="stop" style="display:none">Durdur</button>
          </div>
        </div>

        <div style="margin-top:12px">
          <label style="font-size:13px;color:#9fc2d9">Cüzdan adresi (isteğe bağlı)</label>
          <input id="wallet" placeholder="EQC..." style="width:100%;margin-top:6px;padding:8px;border-radius:8px;border:none;background:#061225;color:#cfeffd">
        </div>

        <div style="margin-top:12px">
          <div class="stat">Hashrate</div>
          <div class="meter"><i id="meterBar"></i></div>
          <div class="stat">Anlık: <strong id="hr">0 H/s</strong> — Kabul edilen pay: <strong id="accepted">0</strong></div>
        </div>

        <div class="footer">
          <div>Telegram WebApp ile entegre. Bot üzerinden açıldığında <code>sendData</code> ile botuna veri gönderir.</div>
        </div>
      </div>

      <div class="panel" style="min-width:200px">
        <div class="stat"><strong>İstatistikler</strong></div>
        <div class="stat">Toplam süre: <span id="runtime">00:00</span></div>
        <div class="stat">Pay gönderildi: <span id="shares">0</span></div>
        <div class="stat">Sahte gelir (demo): <span id="earn">0 TON</span></div>
        <div style="margin-top:12px;">
          <button id="sendBot">Bot'a Gönder (sendData)</button>
        </div>
      </div>
    </div>
  </div>

<script>
/* Basit demo miner — gerçek madencilik yapmaz. 
   Telegram WebApp API varsa kullanır (sendData, MainButton vb). */
let isTelegram = !!(window.Telegram && window.Telegram.WebApp);
const tg = isTelegram ? window.Telegram.WebApp : null;

const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const meter = document.getElementById('meterBar');
const hrText = document.getElementById('hr');
const accepted = document.getElementById('accepted');
const shares = document.getElementById('shares');
const earn = document.getElementById('earn');
const status = document.getElementById('status');
const runtime = document.getElementById('runtime');
const sendBot = document.getElementById('sendBot');
const walletInput = document.getElementById('wallet');

let running=false, secs=0, acceptedCount=0, fakeHR=0;
let tInterval=null, runtimeInterval=null;

function formatTime(s){
  const m = Math.floor(s/60).toString().padStart(2,'0');
  const ss = (s%60).toString().padStart(2,'0');
  return m+':'+ss;
}

function startMining(){
  if(running) return;
  running=true;
  startBtn.style.display='none';
  stopBtn.style.display='inline-block';
  status.innerText='Mining...';
  // Başlangıç değerleri
  secs=0; acceptedCount=0;
  meter.style.width='4%';
  updateStats();

  // fake hashrate ve pay üretimi
  tInterval = setInterval(()=>{
    // hashrate 50 - 1400 H/s arası rastgele değişsin
    fakeHR = Math.max(1, Math.floor(50 + Math.random()*1400));
    const w = Math.min(100, 4 + fakeHR/15); // görsel bar
    meter.style.width = w + '%';
    hrText.innerText = fakeHR + ' H/s';

    // %20 şansla bir pay kabul edildi gibi göster
    if(Math.random() < 0.18){
      acceptedCount += 1;
      accepted.innerText = acceptedCount;
      shares.innerText = acceptedCount;
      // kazanç: her kabul edilen pay için sahte TON
      const amount = (acceptedCount * 0.00005).toFixed(6);
      earn.innerText = amount + ' TON';
      // her kabulde (isteğe bağlı) Telegram botuna bildirim yolla
      if(isTelegram) {
        try { tg.sendData(JSON.stringify({action:'share',accepted:acceptedCount,hr:fakeHR,wallet:walletInput.value||null})); } catch(e){ /* ignore */ }
      }
    }
  }, 1000);

  runtimeInterval = setInterval(()=>{
    secs++;
    runtime.innerText = formatTime(secs);
  }, 1000);
}

function stopMining(){
  if(!running) return;
  running=false;
  startBtn.style.display='inline-block';
  stopBtn.style.display='none';
  status.innerText='Durduruldu';
  clearInterval(tInterval);
  clearInterval(runtimeInterval);
}

function updateStats(){ hrText.innerText = fakeHR + ' H/s'; accepted.innerText = acceptedCount; shares.innerText = acceptedCount; }

startBtn.addEventListener('click', startMining);
stopBtn.addEventListener('click', stopMining);

sendBot.addEventListener('click', ()=>{
  const payload = { action:'manual_report', running, runtime:secs, accepted:acceptedCount, hr:fakeHR, wallet:walletInput.value||null };
  if(isTelegram){
    try{
      tg.sendData(JSON.stringify(payload));
      alert('Bot\'a gönderildi (sendData).');
    }catch(e){
      alert('sendData hatası: ' + e.message);
    }
  } else {
    // Tarayıcıda test modu
    alert('Tarayıcı modu — bot yok. Gönderilecek veri:\n' + JSON.stringify(payload,null,2));
  }
});

/* Eğer Telegram WebApp API varsa bazı opsiyonları ayarla */
if(isTelegram){
  tg.expand();
  // Telegram ana buton kullanmak istersen:
  try {
    window.Telegram.WebApp.MainButton.setText("Mining Başlat");
    window.Telegram.WebApp.MainButton.show();
    window.Telegram.WebApp.MainButton.onClick(startMining);
  } catch(e){}
}

</script>
</body>
</html>
